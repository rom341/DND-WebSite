{% extends "base.html" %}

{% block content %}
    <div class="text-center">
        <h2>Battlefield for Group: {{ group_id }}</h2>
    </div>
    {% include 'partials/battle_map.html' %}
        
    <div>
        <h3>Move Character</h3>
        <form id="move-character-request"
            hx-ext="ws"
            ws-connect="/ws/battle/{{ group_id }}/"
            ws-send>
            {% csrf_token %}
            {{ move_character_form }}
            <input type="hidden" name="group_id" value="{{ group_id }}">
            <button type="submit">Move</button>
        </form>
    </div>
    <div>
        <h3>Add Character to Group</h3>
        <form id="add-character-to-group-form"
            hx-post="{% url 'add_character_to_group' %}"
            hx-target="#battle-map"
            hx-swap="outerHTML">
            {% csrf_token %}
            {{ add_character_form }}
            <input type="hidden" name="group_id" value="{{ group_id }}">
            <button type="submit">Add</button>
        </form>

    </div>
    <div>
        <h3>Add User to Group</h3>
        <form id="add-user-to-group-form"
            hx-post="{% url 'add_user_to_group' %}"
            hx-target="#battle-map"
            hx-swap="outerHTML">
            {% csrf_token %}
            {{ add_user_form }}
            <input type="hidden" name="group_id" value="{{ group_id }}">
            <button type="submit">Add</button>
        </form>
    </div>

    <script>
    document.addEventListener('click', function(event) {
        const clickedCell = event.target.closest('.grid-cell');
        if (!clickedCell || !clickedCell.closest('#battle-map')) {
            return;
        }
        const x = clickedCell.dataset.x;
        const y = clickedCell.dataset.y;
        if (x !== undefined && y !== undefined) {
            
            console.log(`Clicked cell X: ${x}, Y: ${y}`);
            
            const inputX = document.getElementById('id_position_x');
            const inputY = document.getElementById('id_position_y');

            if (inputX && inputY) {
                inputX.value = x;
                inputY.value = y;
                console.log('Position x and Position y fields updated.');
            }
        }
    });
    </script>

{% endblock %}